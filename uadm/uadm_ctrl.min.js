function showMsgError(e,l){e.alerts=[],e.alerts.push({type:"danger",msg:l}),e.lnkNoVisible="false"}vUAdmModule.controller("UAdmController",["$rootScope","$scope","$http","$translate","UAdmStateService","wStorageService",function(e,l,d,t,m,a){"use strict";function o(e){switch(e){case 0:l.admlevel1_model="",l.admlevel2_model="",l.admlevel3_model="",l.admLevel1_list=[],l.admLevel2_list=[],l.admLevel3_list=[],l.idAdmLevel1="",l.nameAdmLevel1="",l.latAdmLevel1="",l.longAdmLevel1="",l.idAdmLevel2="",l.nameAdmLevel2="",l.latAdmLevel2="",l.longAdmLevel2="",l.idAdmLevel3="",l.nameAdmLevel3="",l.latAdmLevel3="",l.longAdmLevel3="",l.countryClassAdd=s,l.admLevel1ClassAdd=s,l.admLevel2ClassAdd=s,l.admLevel3ClassAdd=s,l.txtLocCountry=t.instant("UADM.MSG_NO_LOCATIONS"),l.txtLocAdm1=t.instant("UADM.MSG_NO_LOCATIONS"),l.txtLocAdm2=t.instant("UADM.MSG_NO_LOCATIONS"),l.txtLocAdm3=t.instant("UADM.MSG_NO_LOCATIONS");break;case 1:l.admlevel2_model="",l.admlevel3_model="",l.admLevel2_list=[],l.admLevel3_list=[],l.idAdmLevel1="",l.nameAdmLevel1="",l.latAdmLevel1="",l.longAdmLevel1="",l.idAdmLevel2="",l.nameAdmLevel2="",l.latAdmLevel2="",l.longAdmLevel2="",l.idAdmLevel3="",l.nameAdmLevel3="",l.latAdmLevel3="",l.longAdmLevel3="",l.admLevel1ClassAdd=s,l.admLevel2ClassAdd=s,l.admLevel3ClassAdd=s,l.txtLocAdm1=t.instant("UADM.MSG_NO_LOCATIONS"),l.txtLocAdm2=t.instant("UADM.MSG_NO_LOCATIONS"),l.txtLocAdm3=t.instant("UADM.MSG_NO_LOCATIONS");break;case 2:l.admlevel3_model="",l.admLevel3_list=[],l.idAdmLevel2="",l.nameAdmLevel2="",l.latAdmLevel2="",l.longAdmLevel2="",l.idAdmLevel3="",l.nameAdmLevel3="",l.latAdmLevel3="",l.longAdmLevel3="",l.admLevel2ClassAdd=s,l.admLevel3ClassAdd=s,l.txtLocAdm2=t.instant("UADM.MSG_NO_LOCATIONS"),l.txtLocAdm3=t.instant("UADM.MSG_NO_LOCATIONS");break;case 3:l.idAdmLevel3="",l.nameAdmLevel3="",l.latAdmLevel3="",l.longAdmLevel3="",l.admLevel3ClassAdd=s,l.txtLocAdm3=t.instant("UADM.MSG_NO_LOCATIONS")}}function n(){var d=parseInt(a.get("nq"));if(isNaN(d))a.put("nq",0..toString());else{if(d>e.MAX_QUERIES)return l.alerts=[],l.alerts.push({type:"danger",msg:t.instant("UADM.MAX_USER")}),!1;a.put("nq",(d+1).toString())}return!0}function A(){l.map={center:{latitude:40.437827,longitude:-3.679537},zoom:8},l.options={scrollwheel:!1},l.marker={id:0,coords:{latitude:40.437827,longitude:-3.679537},options:{draggable:!1},events:{dragend:function(){}}}}var L="http://api.geonames.org/childrenJSON?geonameId=";A(),o(0);var s="geonamesListNO",v="geonamesListOK";l.countryClassAdd=s,l.admLevel1ClassAdd=s,l.admLevel2ClassAdd=s,l.admLevel3ClassAdd=s,t("UADM.MSG_NO_LOCATIONS").then(function(e){l.txtLocCountry=e,l.txtLocAdm1=e,l.txtLocAdm2=e,l.txtLocAdm3=e}),l.chkAdmLevel1=!0,l.chkAdmLevel2=!0,l.chkAdmLevel3=!0;var i=a.get("lg");null===i?(t.use("es_ES"),a.put("lg","es_ES"),i="es_ES"):t.use(i),l.alerts=[],a.put("dun",e.USER);var r=e.USER;l.userNoSaved=!1,l.alerts.push({type:"info",msg:t.instant("LOCNAME.DEMO_USER")}),l.lnkNoVisible="true",window.document.title="es_ES"===i?"Unidades Administrativas":"Administrative Units";var c="&username="+r;l.loadCountries=function(){o(0),n()&&d.get(L+l.region_model+c).success(function(e){return null!==e.status&&void 0!==e.status?void showMsgError(l,t.instant("UADM.ERROR_ACCESS")):(l.country_list=e,l.coord="",void(e.totalResultsCount>0?(l.countryClassAdd=v,l.txtLocCountry=t.instant("UADM.MSG_SEL_LOCATIONS")):(l.countryClassAdd=s,l.txtLocCountry=t.instant("UADM.MSG_NO_LOCATIONS"))))}).error(function(){showMsgError(l,t.instant("UADM.ERROR_ACCESS"))})},l.loadAdmLevel1=function(){if(o(1),n()){var e=L+l.country_model.geonameId+c;d.get(e).success(function(e){l.admLevel1_list=e,e.totalResultsCount>0?(l.admLevel1ClassAdd=v,l.txtLocAdm1=t.instant("UADM.MSG_SEL_LOCATIONS")):(l.admLevel1ClassAdd=s,l.txtLocAdm1=t.instant("UADM.MSG_NO_LOCATIONS"))}),l.refreshMap(),l.$watch("latAdmLevel1",function(e){l.chkAdmLevel1=_(e).blank()},!0)}},l.loadAdmLevel2=function(){if(n()){var e=L+l.admlevel1_model.geonameId+c;l.idAdmLevel1=l.admlevel1_model.geonameId,l.nameAdmLevel1=l.admlevel1_model.name,l.latAdmLevel1=l.admlevel1_model.lat,l.longAdmLevel1=l.admlevel1_model.lng,o(2),d.get(e).success(function(e){l.admLevel2_list=e,e.totalResultsCount>0?(l.admLevel2ClassAdd=v,l.txtLocAdm2=t.instant("UADM.MSG_SEL_LOCATIONS")):(l.admLevel2ClassAdd=s,l.txtLocAdm2=t.instant("UADM.MSG_NO_LOCATIONS"))}),l.refreshMap(),l.$watch("latAdmLevel2",function(e){l.chkAdmLevel2=_(e).blank()},!0)}},l.loadAdmLevel3=function(){if(n()){var e=L+l.admlevel2_model.geonameId+c;o(3),l.idAdmLevel2=l.admlevel2_model.geonameId,l.nameAdmLevel2=l.admlevel2_model.name,l.latAdmLevel2=l.admlevel2_model.lat,l.longAdmLevel2=l.admlevel2_model.lng,d.get(e).success(function(e){l.admLevel3_list=e,e.totalResultsCount>0?(l.admLevel3ClassAdd=v,l.txtLocAdm3=t.instant("UADM.MSG_SEL_LOCATIONS")):(l.admLevel3ClassAdd=s,l.txtLocAdm3=t.instant("UADM.MSG_NO_LOCATIONS"))}),l.refreshMap(),l.$watch("latAdmLevel3",function(e){l.chkAdmLevel3=_(e).blank()},!0)}},l.loadAdmLevelProperties=function(){var e=L+l.admlevel3_model.geonameId+c;l.idAdmLevel3=l.admlevel3_model.geonameId,l.nameAdmLevel3=l.admlevel3_model.name,l.latAdmLevel3=l.admlevel3_model.lat,l.longAdmLevel3=l.admlevel3_model.lng,d.get(e).success(function(e){l.loadAdmLevelProperties_list=e}),l.refreshMap()},l.refreshMap=function(){switch(l.coord){case"coordAdmLevel1":l.map.center.latitude=l.latAdmLevel1,l.map.center.longitude=l.longAdmLevel1,l.marker.coords.latitude=l.latAdmLevel1,l.marker.coords.longitude=l.longAdmLevel1,l.map.zoom=8;break;case"coordAdmLevel2":l.map.center.latitude=l.latAdmLevel2,l.map.center.longitude=l.longAdmLevel2,l.marker.coords.latitude=l.latAdmLevel2,l.marker.coords.longitude=l.longAdmLevel2,l.map.zoom=8;break;case"coordAdmLevel3":l.map.center.latitude=l.latAdmLevel3,l.map.center.longitude=l.longAdmLevel3,l.marker.coords.latitude=l.latAdmLevel3,l.marker.coords.longitude=l.longAdmLevel3,l.map.zoom=8;break;default:l.map.center.latitude=40.437827,l.map.center.longitude=-3.679537,l.marker.coords.latitude=40.437827,l.marker.coords.longitude=-3.679537,l.map.zoom=1}},l.closeAlert=function(e){l.alerts.splice(e,1)},e.$on("$translateChangeSuccess",function(){l.txtLocCountry=t.instant("UADM.MSG_SEL_LOCATIONS"),l.txtLocAdm1=t.instant("UADM.MSG_SEL_LOCATIONS"),l.txtLocAdm2=t.instant("UADM.MSG_SEL_LOCATIONS"),l.txtLocAdm3=t.instant("UADM.MSG_SEL_LOCATIONS");var e=a.get("lg");window.document.title="es_ES"===e?"Administrative Units":"Unidades Administrativas",l.alerts=[],l.alerts.push({type:"info",msg:t.instant("LOCNAME.DEMO_USER")})}),e.$on("$locationChangeStart",function(e,d,t){if(-1!=t.indexOf("uadm")){var a={};a.region_model=l.region_model,a.country_list=l.country_list,a.country_model=l.country_model,a.admLevel1_list=l.admLevel1_list,a.admlevel1_model=l.admlevel1_model,a.admLevel2_list=l.admLevel2_list,a.admlevel2_model=l.admlevel2_model,a.admLevel3_list=l.admLevel3_list,a.admlevel3_model=l.admlevel3_model,a.idAdmLevel1=l.idAdmLevel1,a.nameAdmLevel1=l.nameAdmLevel1,a.latAdmLevel1=l.latAdmLevel1,a.longAdmLevel1=l.longAdmLevel1,a.idAdmLevel2=l.idAdmLevel2,a.nameAdmLevel2=l.nameAdmLevel2,a.latAdmLevel2=l.latAdmLevel2,a.longAdmLevel2=l.longAdmLevel2,a.idAdmLevel3=l.idAdmLevel3,a.nameAdmLevel3=l.nameAdmLevel3,a.latAdmLevel3=l.latAdmLevel3,a.longAdmLevel3=l.longAdmLevel3,a.countryClassAdd=l.countryClassAdd,a.admLevel1ClassAdd=l.admLevel1ClassAdd,a.admLevel2ClassAdd=l.admLevel2ClassAdd,a.admLevel3ClassAdd=l.admLevel3ClassAdd,a.txtLocCountry=l.txtLocCountry,a.txtLocAdm1=l.txtLocAdm1,a.txtLocAdm2=l.txtLocAdm2,a.txtLocAdm3=l.txtLocAdm3,a.chkAdmLevel1=l.chkAdmLevel1,a.chkAdmLevel2=l.chkAdmLevel2,a.chkAdmLevel3=l.chkAdmLevel3,a.map=l.map,a.marker=l.marker,m.saveData(a)}if(-1!=d.indexOf("uadm")){var o=m.readData();l.region_model=o.region_model,l.country_list=o.country_list,l.country_model=o.country_model,l.admLevel1_list=o.admLevel1_list,l.admlevel1_model=o.admlevel1_model,l.admLevel2_list=o.admLevel2_list,l.admlevel2_model=o.admlevel2_model,l.admLevel3_list=o.admLevel3_list,l.admlevel3_model=o.admlevel3_model,l.idAdmLevel1=o.idAdmLevel1,l.nameAdmLevel1=o.nameAdmLevel1,l.latAdmLevel1=o.latAdmLevel1,l.longAdmLevel1=o.longAdmLevel1,l.idAdmLevel2=o.idAdmLevel2,l.nameAdmLevel2=o.nameAdmLevel2,l.latAdmLevel2=o.latAdmLevel2,l.longAdmLevel2=o.longAdmLevel2,l.idAdmLevel3=o.idAdmLevel3,l.nameAdmLevel3=o.nameAdmLevel3,l.latAdmLevel3=o.latAdmLevel3,l.longAdmLevel3=o.longAdmLevel3,l.countryClassAdd=o.countryClassAdd,l.admLevel1ClassAdd=o.admLevel1ClassAdd,l.admLevel2ClassAdd=o.admLevel2ClassAdd,l.admLevel3ClassAdd=o.admLevel3ClassAdd,l.txtLocCountry=o.txtLocCountry,l.txtLocAdm1=o.txtLocAdm1,l.txtLocAdm2=o.txtLocAdm2,l.txtLocAdm3=o.txtLocAdm3,l.chkAdmLevel1=o.chkAdmLevel1,l.chkAdmLevel2=o.chkAdmLevel2,l.chkAdmLevel3=o.chkAdmLevel3,l.map=o.map,l.marker=o.marker}})}]);